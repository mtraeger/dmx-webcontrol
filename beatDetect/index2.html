<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Beat Detect 2</title>

    <script src="p5/p5.js"></script>
    <script src="p5/addons/p5.sound.js"></script>
    <script src="p5/addons/p5.dom.js"></script>

    <script>

        //TODO https://p5js.org/reference/#/p5.PeakDetect

        var fft, peakDetect;
        var mic;
        function setup() {
            mic = new p5.AudioIn();
            mic.start();

            fft = new p5.FFT();
            fft.setInput(mic);
            peakDetect = new p5.PeakDetect(); //new p5.PeakDetect([freq1],[freq2],[threshold],[framesPerPeak])

        }
        function draw() {
            background(0);
            micLevel = mic.getLevel();
            ellipse(width / 2, constrain(height - micLevel * height * 5, 0, height), 10, 10);

            // peakDetect accepts an fft post-analysis
            fft.analyze();
            peakDetect.update(fft);

            if (peakDetect.isDetected) {
                loadUrl("/switchNextStep");
//                console.log("beat");
            }


        }


        function loadUrl(url) {
            var req = new XMLHttpRequest();
            req.open("GET", url, true);
            req.send(null);
        }

    </script>


</head>
<body>


Detect beats and emit an event to switch the light. The browser window with this page has to be active (maybe use new window).

Strategy: peakDetect

</body>
</html>